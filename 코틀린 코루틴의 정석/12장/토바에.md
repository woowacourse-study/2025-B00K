# ì½”ë£¨í‹´ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸

## ì½”ë£¨í‹´ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‹œì‘í•˜ê¸°

### ì²« ì½”ë£¨í‹´ í…ŒìŠ¤íŠ¸ ì‘ì„±í•˜ê¸°

í…ŒìŠ¤íŠ¸ ëŒ€ìƒ ê°ì²´

```jsx
class RepeatAddUseCase {
  suspend fun add(repeatTime: Int): Int = withContext(Dispatchers.Default) {
    var result = 0
    repeat(repeatTime) {
      result += 1
    }
    return@withContext result
  }
}
```

add ì¼ì‹œ ì¤‘ë‹¨ í•¨ìˆ˜ëŠ” withContextë¥¼ ì‚¬ìš©í•´ ì½”ë£¨í‹´ì´ ì‚¬ìš©í•˜ëŠ” ìŠ¤ë ˆë“œë¥¼ CPU ë°”ìš´ë“œ ì‘ì—…ì„ ìœ„í•œ ë°±ê·¸ë¼ìš´ë“œ ìŠ¤ë ˆë“œë¡œ ì „í™˜í•œë‹¤.

ë§¤ê°œë³€ìˆ˜ë¡œ ì…ë ¥ëœ repeatTime ë§Œí¼ resultì— 1ì„ ë°˜ë³µí•´ ë”í•˜ê³  ë°˜í™˜í•œë‹¤.

repeatTimeê³¼ ë°˜í™˜ëœ resultì˜ ê°’ì´ ê°™ì•„ì•¼ í•œë‹¤.

í…ŒìŠ¤íŠ¸

```jsx
class RepeatAddUseCaseTest {
  @Test
  fun `100ë²ˆ ë”í•˜ë©´ 100ì´ ë°˜í™˜ëœë‹¤`() {
    // Given
    val repeatAddUseCase = RepeatAddUseCase()

    // When
    val result = repeatAddUseCase.add(100)

    // Then
    assertEquals(100, result)
  }
}
```

<aside>
ğŸ’¡

Suspend function 'add' should be called only from a coroutine or another suspend function

</aside>

â†’ ì»´íŒŒì¼ íƒ€ì„ì— ì˜¤ë¥˜ë¥¼ ë°œìƒì‹œí‚´

ì¼ì‹œ ì¤‘ë‹¨ í•¨ìˆ˜ëŠ” ì½”ë£¨í‹´ ë‚´ë¶€ì—ì„œ ì‹¤í–‰ ë¼ì•¼ í•˜ë¯€ë¡œ í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ë¥¼ runBlocking í•¨ìˆ˜ë¡œ ê°ì‹¸ì•¼ í•œë‹¤.

```jsx
class RepeatAddUseCaseTest {
  @Test
  fun `100ë²ˆ ë”í•˜ë©´ 100ì´ ë°˜í™˜ëœë‹¤`() = runBlocking {
    // Given
    val repeatAddUseCase = RepeatAddUseCase()

    // When
    val result = repeatAddUseCase.add(100)

    // Then
    assertEquals(100, result)
  }
}
```

â†’ ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ëœë‹¤. í•˜ì§€ë§Œ runBlockingì„ ì‚¬ìš©í•˜ë©´ ì‹¤í–‰ì— ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦¬ëŠ” í•¨ìˆ˜ë¥¼ í…ŒìŠ¤íŠ¸í•˜ë©´ ë¬¸ì œê°€ ìƒê¸´ë‹¤.

### runBlockingì„ ì‚¬ìš©í•œ í…ŒìŠ¤íŠ¸ì˜ í•œê³„

```jsx
class RepeatAddWithDelayUseCase {
    suspend fun add(repeatTime: Int): Int {
        var result = 0
        repeat(repeatTime) {
            delay(100L)
            result += 1
        }
        return result
    }
}
```

```jsx
@Test
  fun `runBlocking_100ë²ˆ ë”í•˜ë©´ 100ì´ ë°˜í™˜ëœë‹¤`() = runBlocking {
    // Given
    val repeatAddUseCase = RepeatAddWithDelayUseCase()

    // When
    var result = 0
    result = repeatAddUseCase.add(100)

    // Then
    assertEquals(100, result)
  }
```
í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ëŠ” ë°, 10ì´ˆê°€ ë„˜ê²Œ ê±¸ë¦°ë‹¤.

## ì½”ë£¨í‹´ í…ŒìŠ¤íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬

í…ŒìŠ¤íŠ¸í•  ë•Œ runblocking í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë©´ ì˜¤ëœ ì‹œê°„ì´ ê±¸ë¦´ ìˆ˜ ìˆë‹¤.

ì´ëŸ° ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ì½”ë£¨í‹´ í…ŒìŠ¤íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ê°€ìƒ ì‹œê°„ì„ ì‚¬ìš©í•˜ëŠ” ì½”ë£¨í‹´ ìŠ¤ì¼€ì¤„ëŸ¬ë¥¼ ì œê³µí•œë‹¤.

### ì½”ë£¨í‹´ í…ŒìŠ¤íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì˜ì¡´ì„± ì„¤ì •í•˜ê¸°

ì½”ë£¨í‹´ í…ŒìŠ¤íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬(`kotlinx-coroutines-test`)ì— ëŒ€í•œ ì˜ì¡´ì„±ì„ ì„¤ì •í•´ì•¼ í•œë‹¤.

`build.gradle.kts` íŒŒì¼ì— ì¶”ê°€í•´ ì½”ë£¨í‹´ í…ŒìŠ¤íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ëŒ€í•œ ì˜ì¡´ì„±ì„ ì¶”ê°€ë¡œ ì„¤ì •í•œë‹¤.

```jsx
dependencies {
	testImplementation("org.jetbrains.kotlinx:kotlinx-coroutines-test:1.7.2")
}
```

### TestCoroutineScheduler ì‚¬ìš©í•´ ê°€ìƒ ì‹œê°„ì—ì„œ í…ŒìŠ¤íŠ¸ ì§„í–‰í•˜ê¸°

ì½”ë£¨í‹´ í…ŒìŠ¤íŠ¸ë¥¼ í•  ë•Œ, ì½”ë£¨í‹´ì— ì˜¤ëœ ì‹œê°„ì´ ê±¸ë¦¬ëŠ” ì‘ì—…ì´ í¬í•¨ë¼ ìˆìœ¼ë©´ ê°€ìƒ ì‹œê°„ì„ ì‚¬ìš©í•´ ì½”ë£¨í‹´ì˜ ë™ì‘ì´ ìì‹ ì´ ì›í•˜ëŠ” ì‹œê°„ê¹Œì§€ ë‹¨ë²ˆì— ì§„í–‰ë  ìˆ˜ ìˆë„ë¡ ë§Œë“¤ ìˆ˜ ìˆë‹¤.

â†’ ë¹ ë¥´ê²Œ í…ŒìŠ¤íŠ¸ë¥¼ ì™„ë£Œí•  ìˆ˜ ìˆë‹¤

â†’ ì‹œê°„ì„ ììœ ìì¬ë¡œ ë‹¤ë£° ìˆ˜ ìˆë‹¤

#### advanceTimeBy ì‚¬ìš©í•´ ê°€ìƒ ì‹œê°„ íë¥´ê²Œ ë§Œë“¤ê¸°

```jsx
  @Test
  fun `ê°€ìƒ ì‹œê°„ ì¡°ì ˆ í…ŒìŠ¤íŠ¸`() {
    // í…ŒìŠ¤íŠ¸ í™˜ê²½ ì„¤ì •
    val testCoroutineScheduler = TestCoroutineScheduler()

    testCoroutineScheduler.advanceTimeBy(5000L) // ê°€ìƒ ì‹œê°„ì—ì„œ 5ì´ˆë¥¼ íë¥´ê²Œ ë§Œë“¦ : í˜„ì¬ ì‹œê°„ 5ì´ˆ
    assertEquals(5000L, testCoroutineScheduler.currentTime) // í˜„ì¬ ì‹œê°„ì´ 5ì´ˆ
    testCoroutineScheduler.advanceTimeBy(6000L) // ê°€ìƒ ì‹œê°„ì—ì„œ 6ì´ˆë¥¼ íë¥´ê²Œ ë§Œë“¦ : í˜„ì¬ ì‹œê°„ 11ì´ˆ
    assertEquals(11000L, testCoroutineScheduler.currentTime) // í˜„ì¬ ì‹œê°„ì´ 11ì´ˆ
    testCoroutineScheduler.advanceTimeBy(10000L) // ê°€ìƒ ì‹œê°„ì—ì„œ 10ì´ˆë¥¼ íë¥´ê²Œ ë§Œë“¦ : í˜„ì¬ ì‹œê°„ 21ì´ˆ
    assertEquals(21000L, testCoroutineScheduler.currentTime) // í˜„ì¬ ì‹œê°„ì´ 21ì´ˆ
  }
```

advanceTimeBy í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ë©´ í•¨ìˆ˜ì˜ ì¸ìë¡œ ì…ë ¥ëœ ê°’ë§Œí¼ ê°€ìƒ ì‹œê°„ì´ ë°€ë¦¬ì´ˆ ë‹¨ìœ„ë¡œ íë¥´ê²Œ ëœë‹¤.

`testCoroutineScheduler.currentTime` ê°€ìƒ ì‹œê°„ì´ ì–¼ë§ˆë‚˜ í˜ë €ëŠ”ì§€ í™•ì¸í•˜ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©

#### TestCoroutineSchedulerì™€ StandardTestDispatcher ì‚¬ìš©í•´ ê°€ìƒ ì‹œê°„ ìœ„ì—ì„œ í…ŒìŠ¤íŠ¸ ì§„í–‰í•˜ê¸°

```jsx
@Test
  fun `ê°€ìƒ ì‹œê°„ ìœ„ì—ì„œ í…ŒìŠ¤íŠ¸ ì§„í–‰`() {
    // í…ŒìŠ¤íŠ¸ í™˜ê²½ ì„¤ì •
    val testCoroutineScheduler: TestCoroutineScheduler = TestCoroutineScheduler()
    val testDispatcher: TestDispatcher = StandardTestDispatcher(scheduler = testCoroutineScheduler)
    val testCoroutineScope = CoroutineScope(context = testDispatcher)

    // Given
    var result = 0

    // When
    testCoroutineScope.launch {
      delay(10000L) // 10ì´ˆê°„ ëŒ€ê¸°
      result = 1
      delay(10000L) // 10ì´ˆê°„ ëŒ€ê¸°
      result = 2
      println(Thread.currentThread().name)
    }

    // Then
    assertEquals(0, result)
    testCoroutineScheduler.advanceTimeBy(5000L) // ê°€ìƒ ì‹œê°„ì—ì„œ 5ì´ˆë¥¼ íë¥´ê²Œ ë§Œë“¦ : í˜„ì¬ ì‹œê°„ 5ì´ˆ
    assertEquals(0, result)
    testCoroutineScheduler.advanceTimeBy(6000L) // ê°€ìƒ ì‹œê°„ì—ì„œ 6ì´ˆë¥¼ íë¥´ê²Œ ë§Œë“¦ : í˜„ì¬ ì‹œê°„ 11ì´ˆ
    assertEquals(1, result)
    testCoroutineScheduler.advanceTimeBy(10000L) // ê°€ìƒ ì‹œê°„ì—ì„œ 10ì´ˆë¥¼ íë¥´ê²Œ ë§Œë“¦ : í˜„ì¬ ì‹œê°„ 21ì´ˆ
    assertEquals(2, result)
  }
```

TestCoroutineScheduler()ë¥¼ ë§Œë“¤ê³  StandardTestDispatcherì— ë§Œë“  testCoroutineSchedulerë¥¼ ì¸ìë¡œ ë„˜ê²¨ í…ŒìŠ¤íŠ¸ ë””ìŠ¤íŒ¨ì²˜ ê°ì²´ë¥¼ ë§Œë“ ë‹¤.

ìƒì„±ëœ testDispatcherëŠ” CoroutineScope ì¸ìë¡œ ë„˜ê²¨ì ¸ testDispatcher ê°ì²´ë¥¼ ì‚¬ìš©í•˜ëŠ” CoroutineScope ê°ì²´ë¥¼ ë§Œë“ ë‹¤.

í…ŒìŠ¤íŠ¸ ì‹œ ì§ì ‘ ì‹œê°„ì„ ì»¨íŠ¸ë¡¤í•˜ëŠ” ê²½ìš°ëŠ” ê±°ì˜ ì—†ë‹¤. í•˜ì§€ë§Œ ì½”ë£¨í‹´ í…ŒìŠ¤íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ê¸°ëŠ¥ì„ ì´í•´í•˜ëŠ” ë° ë„ì›€ì´ ëœë‹¤.

#### advanceUntilIdle ì‚¬ìš©í•´ ëª¨ë“  ì½”ë£¨í‹´ ì‹¤í–‰ì‹œí‚¤ê¸°

```jsx
@Test
  fun `advanceUntilIdleì˜ ë™ì‘ ì‚´í´ë³´ê¸°`() {
    // í…ŒìŠ¤íŠ¸ í™˜ê²½ ì„¤ì •
    val testCoroutineScheduler: TestCoroutineScheduler = TestCoroutineScheduler()
    val testDispatcher: TestDispatcher = StandardTestDispatcher(scheduler = testCoroutineScheduler)
    val testCoroutineScope = CoroutineScope(context = testDispatcher)

    // Given
    var result = 0

    // When
    testCoroutineScope.launch {
      delay(10_000L) // 10ì´ˆê°„ ëŒ€ê¸°
      result = 1
      delay(10_000L) // 10ì´ˆê°„ ëŒ€ê¸°
      result = 2
    }
    testCoroutineScheduler.advanceUntilIdle() // testCoroutineScope ë‚´ë¶€ì˜ ì½”ë£¨í‹´ì´ ëª¨ë‘ ì‹¤í–‰ë˜ê²Œ ë§Œë“¦

    // Then
    assertEquals(2, result)
  }
```

`advanceUntilIdle` ëŠ” ì—°ê²°ëœ ëª¨ë“  ì‘ì—…ì´ ëª¨ë‘ ì™„ë£Œë  ë•Œê¹Œì§€ ê°€ìƒ ì‹œê°„ì„ íë¥´ê²Œ ë§Œë“ ë‹¤

#### TestCoroutineScheduler*ë¥¼ í¬í•¨í•˜ëŠ” StandardTestDispatcher*

TestCoroutineScheduler ê°ì²´ë¥¼ ìƒì„±í•´ ë„˜ê²¼ì—ˆì§€ë§Œ, *StandardTestDispatcher í•¨ìˆ˜ì—ëŠ”* TestCoroutineScheduler ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ë¶€ë¶„ì´ í¬í•¨ë¼ ìˆì–´ ì§ì ‘ ìƒì„±í•  í•„ìš”ê°€ ì—†ë‹¤.

```jsx
@Suppress("FunctionName")
public fun StandardTestDispatcher(
    scheduler: TestCoroutineScheduler? = null,
    name: String? = null
): TestDispatcher = StandardTestDispatcherImpl(
    scheduler ?: TestMainDispatcher.currentTestScheduler ?: ***TestCoroutineScheduler()***, name)
```

â†’ ì¸ìë¡œ ë°›ì€ schedulerê°€ ì—†ìœ¼ë©´ TestMainDispatcher.currentTestSchedulerë¥¼ í™•ì¸ í›„ ê·¸ë˜ë„ ì—†ìœ¼ë©´ ìƒˆ ê°ì²´ë¥¼ ë‚´ë¶€ì—ì„œ ìƒì„±í•œë‹¤.

```jsx
@Test
  fun `StandardTestDispatcher ì‚¬ìš©í•˜ê¸°`() {
    // í…ŒìŠ¤íŠ¸ í™˜ê²½ ì„¤ì •
    val testDispatcher: TestDispatcher = StandardTestDispatcher()
    val testCoroutineScope = CoroutineScope(context = testDispatcher)

    // Given
    var result = 0

    // When
    testCoroutineScope.launch {
      delay(10_000L) // 10ì´ˆê°„ ëŒ€ê¸°
      result = 1
      delay(10_000L) // 10ì´ˆê°„ ëŒ€ê¸°
      result = 2
    }

    testDispatcher.scheduler.advanceUntilIdle() // testCoroutineScope ë‚´ë¶€ì˜ ì½”ë£¨í‹´ì´ ëª¨ë‘ ì‹¤í–‰ë˜ê²Œ ë§Œë“¦
    assertEquals(2, result)
  }
```

#### TestScope ì‚¬ìš©í•´ ê°€ìƒ ì‹œê°„ì—ì„œ í…ŒìŠ¤íŠ¸ ì§„í–‰í•˜ê¸°

TestScope í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ë©´ ë‚´ë¶€ì— TestDispather ê°ì²´ë¥¼ ê°€ì§„ TestScope ê°ì²´ê°€ ë°˜í™˜ëœë‹¤.

ì½”ë£¨í‹´ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” TestScopeì— ëŒ€í•œ í™•ì¥ í•¨ìˆ˜ë¥¼ í†µí•´ TestCoroutineScheduler ê°ì²´ì˜ í•¨ìˆ˜ë“¤ê³¼ í”„ë¡œí¼í‹°ë¥¼  TestScope ê°ì²´ê°€ ì§ì ‘ í˜¸ì¶œí•  ìˆ˜ ìˆë„ë¡ ë§Œë“ ë‹¤.

```jsx
@Test
  fun `TestScope ì‚¬ìš©í•˜ê¸°`() {
    // í…ŒìŠ¤íŠ¸ í™˜ê²½ ì„¤ì •
    val testCoroutineScope: TestScope = TestScope()

    // Given
    var result = 0

    // When
    testCoroutineScope.launch {
      delay(10000L) // 10ì´ˆê°„ ëŒ€ê¸°
      result = 1
      delay(10000L) // 10ì´ˆê°„ ëŒ€ê¸°
      result = 2
    }

    testCoroutineScope.advanceUntilIdle() // testCoroutineScope ë‚´ë¶€ì˜ ì½”ë£¨í‹´ì´ ëª¨ë‘ ì‹¤í–‰ë˜ê²Œ ë§Œë“¦
    assertEquals(2, result)
  }
```

TestScope í•¨ìˆ˜ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ StandardTestDispatcher í•¨ìˆ˜ë¡œ ìƒì„±ë˜ëŠ” TestDispatcher ê°ì²´ë¥¼ í¬í•¨í•œë‹¤.

â†’ ë”°ë¼ì„œ TestScope, StandardTestDispatcher, TestCoroutineScheduler ê°ì²´ë¥¼ í¬í•¨í•œë‹¤.

TestScope ê°ì²´ë¥¼ ì§ì ‘ ìƒì„±í•˜ê³ , TestScope ê°ì²´ì— ëŒ€í•´ advanceUntilIdelì„ í˜¸ì¶œí•´ ë‚´ë¶€ì˜ ì½”ë£¨í‹´ì´ ëª¨ë‘ ì‹¤í–‰ë  ë•Œê¹Œì§€ ê°€ìƒ ì‹œê°„ì„ ì§ì ‘ íë¥´ê²Œ ë§Œë“¤ê³  ìˆë‹¤.

### runTest ì‚¬ìš©í•´ í…ŒìŠ¤íŠ¸ ë§Œë“¤ê¸°

#### runTest ì‚¬ìš©í•´ TestScope ëŒ€ì²´í•˜ê¸°

runTest í•¨ìˆ˜ëŠ” ëª¨ë“  ê²ƒì„ ìë™ìœ¼ë¡œ ì‹¤í–‰í•´ ì¤€ë‹¤.

TestScope ê°ì²´ë¥¼ ì‚¬ìš©í•´ ì½”ë£¨í‹´ì„ ì‹¤í–‰ì‹œí‚¤ê³ , ê·¸ ì½”ë£¨í‹´ ë‚´ë¶€ì—ì„œ ì¼ì‹œ ì¤‘ë‹¨ í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ë”ë¼ë„ ì‘ì—…ì´ ê³§ë°”ë¡œ ì‹¤í–‰ ì™„ë£Œë  ìˆ˜ ìˆë„ë¡ ê°€ìƒ ì‹œê°„ì„ íë¥´ê²Œ ë§Œë“œëŠ” ê¸°ëŠ¥ì„ ê°€ì§„ ì½”ë£¨í‹´ ë¹Œë”ì´ë‹¤.

runBlocking í•¨ìˆ˜ë¡œ ë§Œë“¤ì–´ì§€ëŠ” ì½”ë£¨í‹´ê³¼ ìœ ì‚¬í•˜ê²Œ ë™ì‘í•˜ì§€ë§Œ ì§€ì—°ë˜ëŠ” ë¶€ë¶„ì„ ê±´ë„ˆë›°ëŠ” ì½”ë£¨í‹´ì´ ë§Œë“¤ì–´ì§„ë‹¤.

```jsx
@Test
  fun `runTest ì‚¬ìš©í•˜ê¸°`() {
    // Given
    var result = 0

    // When
    runTest { // this: TestScope
      delay(10000L) // 10ì´ˆê°„ ëŒ€ê¸°
      result = 1
      delay(10000L) // 10ì´ˆê°„ ëŒ€ê¸°
      result = 2
    }

    // Then
    assertEquals(2, result)
  }
```

runTestë¥¼ ì‚¬ìš©í•˜ë©´ ê°€ìƒ ì‹œê°„ ìœ„ì—ì„œ í…ŒìŠ¤íŠ¸ê°€ ì§„í–‰ë¼ ì½”ë£¨í‹´ì— ì§€ì—° ì§€ì ì´ ìˆë”ë¼ë„ í•´ë‹¹ ì‹œê°„ ë™ì•ˆ ê°€ìƒ ì‹œê°„ì„ ìë™ìœ¼ë¡œ íë¥´ê²Œ ë§Œë“¤ì–´ ë¹ ë¥´ê²Œ ì‹¤í–‰ ì™„ë£Œëœë‹¤.

#### runTestë¡œ í…ŒìŠ¤íŠ¸ ì „ì²´ ê°ì‹¸ê¸°

```jsx
@Test
  fun `runTestë¡œ í…ŒìŠ¤íŠ¸ ê°ì‹¸ê¸°`() = runTest {  // this: TestScope
    // Given
    var result = 0

    // When
    delay(10000L) // 10ì´ˆê°„ ëŒ€ê¸°
    result = 1
    delay(10000L) // 10ì´ˆê°„ ëŒ€ê¸°
    result = 2

    // Then
    assertEquals(2, result)
  }
```

runTest í•¨ìˆ˜ë¡œ ëª¨ë“  í…ŒìŠ¤íŠ¸ë¥¼ ê°ì‹¸ëŠ” ì´ìœ ëŠ” í…ŒìŠ¤íŠ¸ í™˜ê²½ì„ ì„¤ì •í•˜ëŠ” ë¶€ë¶„ì—ì„œë„ ì¼ì‹œ ì¤‘ë‹¨ í•¨ìˆ˜ê°€ í˜¸ì¶œë  ìˆ˜ ìˆê³ , ê²°ê³¼ë¥¼ ë¹„êµí•˜ëŠ” ë¶€ë¶„ì—ì„œë„ ì¼ì‹œ ì¤‘ë‹¨ í•¨ìˆ˜ê°€ í˜¸ì¶œë  ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ë‹¤.

â†’ ê° ë¶€ë¶„ì—ì„œ ì¼ì‹œ ì¤‘ë‹¨ í•¨ìˆ˜ê°€ í˜¸ì¶œë˜ë”ë¼ë„ ì¼ì‹œ ì¤‘ë‹¨ë˜ëŠ” ì‹œê°„ì„ ê°€ìƒ ì‹œê°„ì„ í†µí•´ ë¹ ë¥´ê²Œ íë¥´ê²Œ ë§Œë“¤ ìˆ˜ ìˆìŒ

#### runTest í•¨ìˆ˜ì˜ ëŒë‹¤ì‹ì—ì„œ TestScope ì‚¬ìš©í•˜ê¸°

runTest í•¨ìˆ˜ëŠ” ëŒë‹¤ì‹ì—ì„œ TestScope ê°ì²´ë¥¼ ìˆ˜ì‹  ê°ì²´ë¡œ ê°–ê¸° ë•Œë¬¸ì— thisë¥¼ í†µí•´ TestScope ê°ì²´ì— ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.

runTest í•¨ìˆ˜ì˜ ëŒë‹¤ì‹ì—ì„œëŠ” TestScope ê°ì²´ê°€ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” advanceTimeBy, advanceUntilIdle ê°™ì€ í™•ì¥ í•¨ìˆ˜ë“¤ê³¼ currentTime í™•ì¥ í”„ë¡œí¼í‹°ë¥¼ ëª¨ë‘ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

```jsx
@Test
  fun `runTestì—ì„œ ê°€ìƒ ì‹œê°„ í™•ì¸`() = runTest {  // this: TestScope
    delay(10000L) // 10ì´ˆê°„ ëŒ€ê¸°
    println("ê°€ìƒ ì‹œê°„: ${this.currentTime}ms") // ê°€ìƒ ì‹œê°„: 10000ms
    delay(10000L) // 10ì´ˆê°„ ëŒ€ê¸°
    println("ê°€ìƒ ì‹œê°„: ${this.currentTime}ms") // ê°€ìƒ ì‹œê°„: 20000ms
  }
  /*
  // ê²°ê³¼:
  ê°€ìƒ ì‹œê°„: 10000ms
  ê°€ìƒ ì‹œê°„: 20000ms
  */
```

runTest í•¨ìˆ˜ì—ì„œ advanceTimeBy í•¨ìˆ˜ë‚˜ advanceUntilIdle í•¨ìˆ˜ëŠ” ì–¸ì œ ì‚¬ìš©í•  ìˆ˜ ìˆì„ê¹Œ?

runTestì˜ TestScope ë‚´ë¶€ì—ì„œ ìƒˆë¡œìš´ ì½”ë£¨í‹´ì´ ì‹¤í–‰ë  ë•Œ í•´ë‹¹ ì½”ë£¨í‹´ì´ ëª¨ë‘ ì‹¤í–‰ ì™„ë£Œë  ë•Œê¹Œì§€ ê°€ìƒ ì‹œê°„ì„ íë¥´ê²Œ í•˜ëŠ” ë° ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

```jsx
@Test
  fun `runTest ë‚´ë¶€ì—ì„œ advanceUntilIdle ì‚¬ìš©í•˜ê¸°`() = runTest {  // this: TestScope
    var result = 0
    launch {
      delay(1000L)
      result = 1
    }

    println("ê°€ìƒ ì‹œê°„: ${this.currentTime}ms, result = ${result}") // ê°€ìƒ ì‹œê°„: 0ms, result = 0
    advanceUntilIdle()
    println("ê°€ìƒ ì‹œê°„: ${this.currentTime}ms, result = ${result}") // ê°€ìƒ ì‹œê°„: 1000ms, result = 1
  }
```

launch í•¨ìˆ˜ì˜ ëŒë‹¤ì‹ ë‚´ë¶€ì—ì„œ launch ì½”ë£¨í‹´ì´ ìƒˆë¡­ê²Œ ìƒì„±ëœë‹¤.

runTest í•¨ìˆ˜ëŠ” runTest í•¨ìˆ˜ë¡œ ìƒì„±ëœ ë‚´ë¶€ì—ì„œ ì‹¤í–‰ëœ ì¼ì‹œ ì¤‘ë‹¨ í•¨ìˆ˜ì— ëŒ€í•´ì„œë§Œ ê°€ìƒ ì‹œê°„ì´ íë¥´ê²Œ ë§Œë“ ë‹¤.

TestScope ìƒì—ì„œ ìƒˆë¡œ ì‹¤í–‰ëœ launch ì½”ë£¨í‹´ì— ëŒ€í•´ì„œëŠ” ìë™ìœ¼ë¡œ ì‹œê°„ì„ íë¥´ê²Œ í•˜ì§€ ì•ŠëŠ”ë‹¤.

â†’ advanceUntilIdleì´ í˜¸ì¶œë¼ì•¼ runTest ë¸”ë¡ ë‚´ë¶€ì—ì„œ ìƒˆë¡œ ìƒì„±ëœ ì½”ë£¨í‹´ë“¤ì´ ì‹¤í–‰ ì™„ë£Œë  ë•Œê¹Œì§€ ì‹œê°„ì´ íë¥¸ë‹¤.

<aside>
ğŸ’¡

ë©€í‹° ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œì˜ ì½”ë£¨í‹´ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ì„œëŠ” ì—¬ëŸ¬ ì½”ë£¨í‹´ì´ ë³‘ë ¬ë¡œ ì‹¤í–‰ë˜ëŠ” ìƒí™©ì´ í…ŒìŠ¤íŠ¸ ë˜ì–´ì•¼ í•œë‹¤.

</aside>

â†’ ê°€ìƒ ì‹œê°„ì„ íë¥´ê²Œ ë§Œë“¤ì–´ ì¦‰ì‹œ ì‹¤í–‰ ì™„ë£Œ ì‹œí‚¤ë©´ ì½”ë£¨í‹´ì´ ìˆ ì°¨ì ìœ¼ë¡œ ì‹¤í–‰ë˜ë¯€ë¡œ ë³‘ë ¬ í™˜ê²½ì—ì„œì˜ ì½”ë£¨í‹´ í…ŒìŠ¤íŠ¸ê°€ ì œëŒ€ë¡œ ì´ë¤„ì§ˆ ìˆ˜ ì—†ë‹¤.

runTest ë‚´ë¶€ì—ì„œ ëª¨ë“  ì½”ë£¨í‹´ì´ ìƒì„±ë˜ê³  ë‚˜ì„œ advanceUntilIdleì„ í˜¸ì¶œí•´ ìƒì„±ëœ ëª¨ë“  ì½”ë£¨í‹´ì´ í•¨ê»˜ ì‹¤í–‰ë  ìˆ˜ ìˆë„ë¡ í•´ì•¼ í…ŒìŠ¤íŠ¸ê°€ ì œëŒ€ë¡œ ì´ë¤„ì§ˆ ìˆ˜ ìˆë‹¤.

```jsx
@Test
  fun `runTest ë‚´ë¶€ì—ì„œ join ì‚¬ìš©í•˜ê¸°`() = runTest {  // this: TestScope
    var result = 0
    launch {
      delay(1000L)
      result = 1
    }.join()

    println("ê°€ìƒ ì‹œê°„: ${this.currentTime}ms, result = ${result}") // ê°€ìƒ ì‹œê°„: 1000ms, result = 1
  }
```

ë§Œì•½ runTest ì½”ë£¨í‹´ì˜ ìì‹ ì½”ë£¨í‹´ì„ ìƒì„±í•˜ê³  í•´ë‹¹ ì½”ë£¨í‹´ì— ëŒ€í•´ joinì„ í˜¸ì¶œí•˜ë©´ advanceUntilIdleì„ í˜¸ì¶œí•˜ì§€ ì•Šë”ë¼ë„ runTest ì½”ë£¨í‹´ì˜ ê°€ìƒ ì‹œê°„ì´ íë¥¸ë‹¤.

â†’ join í•¨ìˆ˜ì˜ í˜¸ì¶œì´ runTest ì½”ë£¨í‹´ì„ ì¼ì‹œ ì¤‘ë‹¨ì‹œí‚¤ê¸° ë•Œë¬¸ì´ë‹¤.

## ì½”ë£¨í‹´ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ë§Œë“¤ì–´ë³´ê¸°

#### ì½”ë£¨í‹´ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ì½”ë“œ ì¤€ë¹„í•˜ê¸°

```jsx
sealed class Follower(
  open val id: String,
  open val name: String
) {
  data class OfficialAccount(
    override val id: String,
    override val name: String
  ) : Follower(id, name)

  data class PersonAccount(
    override val id: String,
    override val name: String
  ) : Follower(id, name)
}
```

FollowerëŠ” ì„œë¸Œíƒ€ì…ìœ¼ë¡œ OfficialAccountì™€ PersonAccountë¥¼ ê°€ì§„ë‹¤.

```jsx
class FollowerSearcher(
  private val officialAccountRepository: OfficialAccountRepository,
  private val personAccountRepository: PersonAccountRepository
) {
  suspend fun searchByName(name: String): List<Follower> = coroutineScope {
    val officialAccountsDeferred = async {
      officialAccountRepository.searchByName(name)
    }
    val personAccountsDeferred = async {
      personAccountRepository.searchByName(name)
    }

    return@coroutineScope listOf(
      *officialAccountsDeferred.await(),
      *personAccountsDeferred.await()
    )
  }
}
```

í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•˜ê¸° ìœ„í•´ì„œëŠ” OfficialAccountRepositoryì™€ PersonAccountRepositoryì— ëŒ€í•œ í…ŒìŠ¤íŠ¸ ë”ë¸”ì´ í•„ìš”í•˜ë‹¤.

```jsx
class StubOfficialAccountRepository(
  private val users: List<Follower.OfficialAccount>
) : OfficialAccountRepository {
  override suspend fun searchByName(name: String): Array<Follower.OfficialAccount> {
    delay(1000L)
    return users.filter { user ->
      user.name.contains(name)
    }.toTypedArray()
  }
}
```

```jsx
class StubPersonAccountRepository(
  private val users: List<Follower.PersonAccount>
) : PersonAccountRepository {
  override suspend fun searchByName(name: String): Array<Follower.PersonAccount> {
    delay(1000L)
    return users.filter { user ->
      user.name.contains(name)
    }.toTypedArray()
  }
}
```

```jsx
class FollowerSearcherTest {

  private lateinit var followerSearcher: FollowerSearcher

  @BeforeEach
  fun setUp() {
    followerSearcher = FollowerSearcher(
      officialAccountRepository = stubOfficialAccountRepository,
      personAccountRepository = stubPersonAccountRepository
    )
  }

  companion object {
    private val companyA = Follower.OfficialAccount(id = "0x0000", name = "CompanyA")
    private val companyB = Follower.OfficialAccount(id = "0x0001", name = "CompanyB")
    private val companyC = Follower.OfficialAccount(id = "0x0002", name = "CompanyC")

    private val stubOfficialAccountRepository = StubOfficialAccountRepository(
      users = listOf(companyA, companyB, companyC)
    )

    private val personA = Follower.PersonAccount(id = "0x1000", name = "PersonA")
    private val personB = Follower.PersonAccount(id = "0x1001", name = "PersonB")
    private val personC = Follower.PersonAccount(id = "0x1002", name = "PersonC")

    private val stubPersonAccountRepository = StubPersonAccountRepository(
      users = listOf(personA, personB, personC)
    )
  }
}
```

#### í…ŒìŠ¤íŠ¸ ì‘ì„±í•˜ê¸°

```jsx
@Test
  fun `ê³µì‹ ê³„ì •ê³¼ ê°œì¸ ê³„ì •ì´ í•©ì³ì ¸ ë°˜í™˜ë˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸`() = runTest {
    // Given
    val searchName = "A"
    val expectedResults = listOf(companyA, personA)

    // When
    val results = followerSearcher.searchByName(searchName)

    // Then
    Assertions.assertEquals(
      expectedResults,
      results
    )
  }
```

ì¼ì‹œ ì¤‘ë‹¨ í•¨ìˆ˜ì¸ searchByNameì„ í…ŒìŠ¤íŠ¸í•˜ê¸° ë•Œë¬¸ì— ëª¨ë“  í…ŒìŠ¤íŠ¸ë¥¼ runTestë¡œ ê°ì‹¼ë‹¤.

â†’ ì§€ì—° ì‹œê°„ì„ ì—†ì•¨ ìˆ˜ ìˆë‹¤.

```jsx
@Test
  fun `ë¹ˆ ë°°ì—´ì´ ë°˜í™˜ë˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸`() = runTest {
    // Given
    val searchName = "Empty"
    val expectedResults = emptyList<Follower>()

    // When
    val results = followerSearcher.searchByName(searchName)

    // Then
    Assertions.assertEquals(
      expectedResults,
      results
    )
  }
```

## ì½”ë£¨í‹´ í…ŒìŠ¤íŠ¸ ì‹¬í™”

#### í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ ìƒˆë¡œìš´ ì½”ë£¨í‹´ì„ ì‹¤í–‰í•˜ëŠ” ê°ì²´ì— ëŒ€í•œ í…ŒìŠ¤íŠ¸

ì¼ì‹œ ì¤‘ë‹¨ í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ ìƒˆë¡œìš´ ì½”ë£¨í‹´ì„ ìƒì„±í•˜ëŠ” ë™ì‘ì€ í…ŒìŠ¤íŠ¸í•˜ê¸° ì‰½ë‹¤.

í•˜ì§€ë§Œ ì¼ì‹œ ì¤‘ë‹¨ í•¨ìˆ˜ê°€ ì•„ë‹Œ í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ ìƒˆë¡œìš´ ì½”ë£¨í‹´ì„ ì‹¤í–‰í•˜ëŠ” ê²½ìš°ê°€ ìˆë‹¤.

```jsx
class StringStateHolder {
  private val coroutineScope = CoroutineScope(Dispatchers.IO)

  var stringState = ""
    private set

  fun updateStringWithDelay(string: String) {
    coroutineScope.launch {
      delay(1000L)
      stringState = string
    }
  }
}
```

```jsx
class StringStateHolderTestFail {
  @Test
  fun `updateStringWithDelay(ABC)ê°€ í˜¸ì¶œë˜ë©´ ë¬¸ìì—´ì´ ABCë¡œ ë³€ê²½ëœë‹¤`() = runTest {
    // Given
    val stringStateHolder = StringStateHolder()

    // When
    stringStateHolder.updateStringWithDelay("ABC")

    // Then
    advanceUntilIdle()
    Assertions.assertEquals("ABC", stringStateHolder.stringState)
  }
}
```

í…ŒìŠ¤íŠ¸ëŠ” ë¹ˆ ë¬¸ìì—´ë¡œ ì‹¤íŒ¨í•œë‹¤.

StringStateHolder ê°ì²´ ë‚´ë¶€ì— ìˆëŠ” CoroutineScope ê°ì²´ ë•Œë¬¸ì´ë‹¤.

CoroutineScope ê°ì²´ëŠ” ë£¨íŠ¸ Job ê°ì²´ë¥¼ ê°–ê¸° ë•Œë¬¸ì— runTestë¡œ ìƒì„±ë˜ëŠ” ì½”ë£¨í‹´ê³¼ êµ¬ì¡°í™”ë˜ì§€ ì•ŠëŠ”ë‹¤.

ì½”ë£¨í‹´ì„ ì‹¤í–‰í•  ë•Œ Dispatchers.IOë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ì‹¤ì œ ì‹œê°„ ìœ„ì—ì„œ ì‹¤í–‰ëœë‹¤.

ì–´ë–»ê²Œ í•´ê²°í• ê¹Œ?

CoroutineScope ê°ì²´ê°€ TestCoroutineScheduler ê°ì²´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•´ì•¼ í•œë‹¤.

ê°€ì¥ ì‰¬ìš´ ë°©ë²•ì€ CoroutineScope ìƒì„± í•¨ìˆ˜ì—ì„œ ì‚¬ìš©í•˜ëŠ” CoroutineDispatcher ê°ì²´ë¥¼ StringStateHolderì— ì£¼ì…ë°›ë„ë¡ êµ¬í˜„ì„ ë³€ê²½í•˜ëŠ” ê²ƒì´ë‹¤.

```jsx
class StringStateHolder(
  private val dispatcher: CoroutineDispatcher = Dispatchers.IO
) {
  private val coroutineScope = CoroutineScope(dispatcher)

  var stringState = ""
    private set

  fun updateStringWithDelay(string: String) {
    coroutineScope.launch {
      delay(1000L)
      stringState = string
    }
  }
}
```

```jsx
fun `updateStringWithDelay(ABC)ê°€ í˜¸ì¶œë˜ë©´ ë¬¸ìì—´ì´ ABCë¡œ ë³€ê²½ëœë‹¤`() {
    // Given
    val testDispatcher = StandardTestDispatcher()
    val stringStateHolder = StringStateHolder(
      dispatcher = testDispatcher
    )

    // When
    stringStateHolder.updateStringWithDelay("ABC")

    // Then
    testDispatcher.scheduler.advanceUntilIdle()
    Assertions.assertEquals("ABC", stringStateHolder.stringState)
  }
```

ì´ í…ŒìŠ¤íŠ¸ì—ì„œëŠ” ì¼ì‹œ ì¤‘ë‹¨ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ” ë¶€ë¶„ì´ ì—†ê¸° ë•Œë¬¸ì— runTest í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.

ëŒ€ì‹  StandardTestDispatcherë¥¼ í†µí•´ CoroutineDispatcher ê°ì²´ë¥¼ ë§Œë“¤ì–´ StringStateHolderë¥¼ ì´ˆê¸°í™”í•  ë•Œ ì£¼ì…í•˜ê³ , ê°ì²´ ë‚´ë¶€ì—ì„œ ë§Œë“¤ì–´ì§„ ì½”ë£¨í‹´ì´ ëª¨ë‘ ì‹¤í–‰ ì™„ë£Œë¨ì„ ë³´ì¥í•˜ê¸° ìœ„í•´ `testDispatcher.scheduler.advanceUntilIdle()` ë¥¼ í˜¸ì¶œí•œë‹¤.

#### backgroundScopeë¥¼ ì‚¬ìš©í•´ í…ŒìŠ¤íŠ¸ ë§Œë“¤ê¸°

runTest í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•  ê²½ìš° runTest í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•´ ìƒì„±í•˜ëŠ” ì½”ë£¨í‹´ì€ ë©”ì¸ ìŠ¤ë ˆë“œë¥¼ ì‚¬ìš©í•˜ëŠ”ë° ë‚´ë¶€ì˜ ëª¨ë“  ì½”ë£¨í‹´ì´ ì‹¤í–‰ë  ë•Œê¹Œì§€ ì¢…ë£Œë˜ì§€ ì•ŠëŠ”ë‹¤.

```jsx
  @Test
  fun `ë©”ì¸ ìŠ¤ë ˆë“œë§Œ ì‚¬ìš©í•˜ëŠ” runTest`() = runTest {
    println(Thread.currentThread())
  }
  /*
  // ê²°ê³¼:
  Thread[Test worker @kotlinx.coroutines.test runner#5,5,main]
  */
```

runTest ì½”ë£¨í‹´ ë‚´ë¶€ì—ì„œ launch í•¨ìˆ˜ê°€ í˜¸ì¶œë¼ ì½”ë£¨í‹´ì´ ìƒì„±ë˜ê³ , ì´ ì½”ë£¨í‹´ ë‚´ë¶€ì—ì„œ whileë¬¸ ê°™ì€ ë¬´í•œíˆ ì‹¤í–‰ë˜ëŠ” ì‘ì—…ì´ ì‹¤í–‰ëœë‹¤ë©´ í…ŒìŠ¤íŠ¸ê°€ ê³„ì†í•´ì„œ ì‹¤í–‰ëœë‹¤.

```jsx
@OptIn(ExperimentalCoroutinesApi::class)
  @Test
  fun `ëë‚˜ì§€ ì•Šì•„ ì‹¤íŒ¨í•˜ëŠ” í…ŒìŠ¤íŠ¸`() = runTest {
    var result = 0

    launch {
      while (true) {
        delay(1000L)
        result += 1
      }
    }

    advanceTimeBy(1500L)
    Assertions.assertEquals(1, result)
    advanceTimeBy(1000L)
    Assertions.assertEquals(2, result)
  }

  /*
  // ê²°ê³¼:
  After waiting for 10s, the test coroutine is not completing, there were active child jobs: ["coroutine#3":StandaloneCoroutine{Active}@381f03c1]
  kotlinx.coroutines.test.UncompletedCoroutinesError: After waiting for 10s, the test coroutine is not completing, there were active child jobs: ["coroutine#3":StandaloneCoroutine{Active}@381f03c1]
  at app//kotlinx.coroutines.test.TestBuildersKt__TestBuildersKt$runTest$2$1$2$1.invoke(TestBuilders.kt:349)
  at app//kotlinx.coroutines.test.TestBuildersKt__TestBuildersKt$runTest$2$1$2$1.invoke(TestBuilders.kt:333)
  ...
  */
```

runTest ë‚´ë¶€ì—ì„œ launch í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•´ ìƒˆë¡œìš´ ì½”ë£¨í‹´ì„ ìƒì„±í•˜ê³  1ì´ˆë§ˆë‹¤ resultì˜ ê°’ì„ 1ì”© ì¦ê°€ì‹œí‚¨ë‹¤.

ê²°ê³¼ì˜ ì˜ë¯¸ëŠ” runTest ì½”ë£¨í‹´ì´ ë§ˆì§€ë§‰ ì½”ë“œì¸ Assertions.assertEquals(2, result)ë¥¼ ì‹¤í–‰í•˜ê³  ë‚˜ì„œ â€˜ì‹¤í–‰ ì™„ë£Œ ì¤‘â€™ ìƒíƒœë¡œ ë³€ê²½ëì§€ë§Œ whileë¬¸ì— ì˜í•´ launch ì½”ë£¨í‹´ì´ ê³„ì†í•´ì„œ ì‹¤í–‰ë¼ í…ŒìŠ¤íŠ¸ê°€ ì¢…ë£Œë˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì´ë‹¤.

runTest ì½”ë£¨í‹´ì´ í…ŒìŠ¤íŠ¸ê°€ ë¬´í•œíˆ ì‹¤í–‰ë˜ëŠ” ê²ƒì„ ë°©ì§€í•˜ë ¤ê³  ì½”ë£¨í‹´ì´ â€˜ì‹¤í–‰ ì™„ë£Œ ì¤‘â€™ ìƒíƒœë¡œ ë³€í•œ í›„ ì¼ì • ì‹œê°„ ë’¤ì—ë„ í…ŒìŠ¤íŠ¸ê°€ ì¢…ë£Œë˜ì§€ ì•Šìœ¼ë©´ UnCompletedCoroutinesError ì˜ˆì™¸ë¥¼ ë˜ì ¸ ê°•ì œë¡œ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤íŒ¨í•˜ê²Œ ë§Œë“ ë‹¤.

```jsx
@Test
  fun `backgroundScopeë¥¼ ì‚¬ìš©í•˜ëŠ” í…ŒìŠ¤íŠ¸`() = runTest {
    var result = 0

    backgroundScope.launch {
      while (true) {
        delay(1000L)
        result += 1
      }
    }

    advanceTimeBy(1500L)
    Assertions.assertEquals(1, result)
    advanceTimeBy(1000L)
    Assertions.assertEquals(2, result)
  }
```

ë¬´í•œíˆ ì‹¤í–‰ë˜ëŠ” ì‘ì—…ì„ í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•´ì„œëŠ” runTest ëŒë‹¤ì‹ì˜ ìˆ˜ì‹  ê°ì²´ì¸ TestScopeê°€ ì œê³µí•˜ëŠ” backgroundScopeë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

backgroundScopeëŠ” runTest ì½”ë£¨í‹´ì˜ ëª¨ë“  ì½”ë“œê°€ ì‹¤í–‰ë˜ë©´ ìë™ìœ¼ë¡œ ì·¨ì†Œë˜ë©°, ì´ë¥¼ í†µí•´ í…ŒìŠ¤íŠ¸ê°€ ë¬´í•œíˆ ì‹¤í–‰ë˜ëŠ” ê²ƒì„ ë°©ì§€í•  ìˆ˜ ìˆë‹¤.
