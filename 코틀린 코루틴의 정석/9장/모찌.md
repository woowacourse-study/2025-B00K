# 9장. 일시 중단 함수
# 1. 일시 중단 함수와 코루틴

- `suspend` : 중단하다
- **`delay`와 `Thread.sleep`의 차이**
    - `Thread.sleep(1000)` → 스레드 자체를 1초 멈춤 (비효율적)
    - `delay(1000)`
        
        → 스레드는 다른 일을 하고 있다가, 1초 후에 코루틴을 다시 깨움 (효율적) 
        
        → 코루틴의 상태를 보존하고 중단/재개할 수 있음!
        
        ![image.png](attachment:092c3d28-6926-4324-b515-60125342471a:image.png)
        

## 1. 일시 중단 함수란 무엇인가?

- `suspend fun` : 함수 내에 일시 중단 지점을 포함할 수 있음
    
    ```kotlin
    fun delayAndPrintHelloWorld() {
        delay(1000L)
        println("Hello World")
    }
    
    fun main() =
        runBlocking<Unit> {
            delayAndPrintHelloWorld()
            delayAndPrintHelloWorld()
        }
    ```
    
    ![image.png](attachment:648261f4-78ae-4008-a82f-86795b430bc3:image.png)
    
    ```kotlin
    suspend fun delayAndPrintHelloWorld() {
        delay(1000L)
        println("Hello World")
    }
    
    fun main() =
        runBlocking<Unit> {
            delayAndPrintHelloWorld()
            delayAndPrintHelloWorld()
        }
    ```
    

## 2. 일시 중단 함수는 코루틴이 아니다

- 아래의 코드 중 코루틴을 생성한 개수 → **1개**
    
    ![image.png](attachment:72196043-f1bf-4fec-9674-e416013b104a:image.png)
    
    ![image.png](attachment:b972a335-d882-4663-9481-0c4ae3dfad17:image.png)
    
    → 즉, 일시중단하는 함수는 **코루틴이 아니다!**
    

## 3. 일시 중단 함수를 별도의 코루틴상에서 실행하기

- 일시 중단 함수를 **새로운 코루틴에서 실행**하고 싶으면 일시 중단 함수를 코루틴 빌더 함수로 감싸면 됨!
    
    ![image.png](attachment:0456c16b-1980-4d94-b54c-f3be654dc30b:image.png)
    

# 2. 일시 중단 함수의 사용

## 1. 일시 중단 함수의 호출 가능 지점

- 일시 중단 함수는 내부에 일시 중단이 포함됨! → 일시 중단이 할 수 있는 곳에서만 호출
- 코틀린에서 일시 중단이 가능한 지점
    - 코루틴 내부
    - 일시 중단 함수

### 1. 코루틴 내부에서 일시 중단 함수 호출하기

![image.png](attachment:2990ab5b-4dbb-4779-9d15-57938b049e9a:image.png)

### 2. 일시 중단 함수에서 다른 일시 중단 함수 호출하기

![image.png](attachment:f60b06e4-7fa9-4203-98a7-9a12eefbe243:image.png)

## 2. 일시 중단 함수에서 코루틴 실행하기

### 1. 일시 중단 함수에서 코루틴 빌더 호출 시 생기는 문제

![image.png](attachment:4b5db644-0633-4478-84f8-f2b8cd7bed88:image.png)

- 코루틴 빌더인 `launch()` 와 `async()` 는 `CoroutineScope` 의 확장함수이다!
    
    → 일시 중단 함수 내부에서는 `CoroutineScope` 객체 내부에 접근할 수 없다.
    

### 2. coroutineScope 사용해 일시 중단 함수에서 코루틴 실행하기

![image.png](attachment:48c9bda4-1f4f-42d3-ab0b-5db26c26d057:image.png)

![image.png](attachment:c28c3f62-9ff6-4891-aa6c-91caf8b0bc7d:image.png)

- coroutineScope 일시 중단 함수를 사용 → 일시 중단 함수 내부에 새로운 CoroutineScope 객체를 생성

![image.png](attachment:878e8d1e-7d42-4246-8abe-5656951cd4d6:image.png)

→ 여기서 문제! DB에서 조회하는 곳에서 문제가 생기면, 서버 조회하는 코루틴까지 취소됨!

![image.png](attachment:36073af0-89ed-4f9b-886f-51a9a28aa6e3:image.png)

### 3. supervisorScope 사용해 일시 중단 함수에서 코루틴 실행하기

- supervisor 객체를 통해서, DB에서 발생한 예외가 서버로 전파되지 않았음!

![image.png](attachment:0332a48c-dacc-4db7-aac0-8962dab34893:image.png)

![image.png](attachment:de7c5702-0787-4347-8715-20bc736763de:image.png)
